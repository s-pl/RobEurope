<%- include('../partials/header', { title: action === 'add' ? t('ldap.form.addTitle') : t('ldap.form.editTitle') }) %>

<section class="page-header">
    <div>
        <p class="page-eyebrow"><%= t('ldap.eyebrow') %></p>
        <h2 class="page-title"><%= action === 'add' ? t('ldap.form.addTitle') : t('ldap.form.editTitle') %></h2>
    </div>
</section>

<div class="card" style="max-width: 640px;">
    <form action="<%= action === 'add' 
        ? '/admin/ldap-users/add' 
        : `/admin/ldap-users/edit/${(typeof formUid !== 'undefined' && formUid) 
              ? formUid 
              : (user ? (Array.isArray(user.uid) ? user.uid[0] : user.uid) : '')}` %>" 
        method="POST" class="form-stack">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        
        <div>
            <label for="uid"><%= t('ldap.form.uid') %></label>
            <input type="text" id="uid" name="uid" value="<%= user ? (Array.isArray(user.uid) ? user.uid[0] : user.uid) : '' %>" <%= action === 'edit' ? 'readonly' : '' %> required>
        </div>

        <div class="form-grid">
            <div>
                <label for="cn"><%= t('ldap.form.firstName') %></label>
                <input type="text" id="cn" name="cn" value="<%= user ? (Array.isArray(user.cn) ? user.cn[0] : user.cn) : '' %>" required>
            </div>
            <div>
                <label for="sn"><%= t('ldap.form.lastName') %></label>
                <input type="text" id="sn" name="sn" value="<%= user ? (Array.isArray(user.sn) ? user.sn[0] : user.sn) : '' %>" required>
            </div>
        </div>

        <div>
            <label for="mail"><%= t('ldap.form.email') %></label>
            <input type="email" id="mail" name="mail" value="<%= user ? (Array.isArray(user.mail) ? user.mail[0] : user.mail) : '' %>" required>
        </div>

        <div>
            <label for="password">
                <%= t('ldap.form.password') %>
                <span style="color: var(--muted-foreground); font-weight:400;">
                    <%= action === 'edit' ? t('ldap.form.passwordHint') : '' %>
                </span>
            </label>
            <input type="password" id="password" name="password" <%= action === 'add' ? 'required' : '' %>>
        </div>

        <div class="form-actions">
            <a href="/admin/ldap-users" class="btn btn-muted"><%= t('ldap.form.cancel') %></a>
            <button type="submit" class="btn btn-primary"><%= action === 'add' ? t('ldap.form.submitAdd') : t('ldap.form.submitEdit') %></button>
        </div>
    </form>
</div>

<%- include('../partials/footer') %>