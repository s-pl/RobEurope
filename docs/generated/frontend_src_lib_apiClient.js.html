<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: frontend/src/lib/apiClient.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: frontend/src/lib/apiClient.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview
 * Frontend HTTP client utilities.
 *
 * All API requests are routed through `VITE_API_BASE_URL` (configured in `frontend/.env`).
 * The application uses cookie-based sessions, so requests are sent with `credentials: 'include'`.
 */

/**
 * Normalizes a base URL into an API base ending with `/api`.
 *
 * Examples:
 * - `http://localhost:85` -> `http://localhost:85/api`
 * - `http://localhost:85/api/` -> `http://localhost:85/api`
 *
 * @param {string} url Raw base URL.
 * @returns {string} Normalized API base URL or empty string.
 */
const normalizeBase = (url) => {
  if (!url || typeof url !== 'string') return '';
  const trimmed = url.replace(/\/$/, '');
  if (/\/api$/i.test(trimmed)) return trimmed;
  return `${trimmed}/api`;
};

const requireApiBaseUrl = () => {
  const envBase = normalizeBase(import.meta.env.VITE_API_BASE_URL || '');
  if (!envBase) {
    throw new Error(
      'Falta VITE_API_BASE_URL. Configúralo en frontend/.env (ej: VITE_API_BASE_URL=http://localhost:85 o http://localhost:85/api)'
    );
  }
  return envBase;
};

const getApiBaseUrl = () => requireApiBaseUrl();

/**
 * Returns the backend origin (without the `/api` suffix).
 *
 * This is primarily used for Socket.IO and for serving static assets.
 *
 * @returns {string} Origin URL, e.g. `http://localhost:85`.
 */
export const getApiOrigin = () => getApiBaseUrl().replace(/\/?api\/?$/, '');

/**
 * Parses a fetch Response into JSON (when possible) or plain text.
 * @param {Response} response Fetch response.
 * @returns {Promise&lt;any>} Parsed payload.
 */
const parseResponse = async (response) => {
  const contentType = response.headers.get('content-type');
  if (contentType &amp;&amp; contentType.includes('application/json')) {
    return response.json();
  }
  return response.text();
};

/**
 * Executes an API request against the configured backend.
 *
 * Notes:
 * - `path` must be an API path starting with `/` (e.g. `/teams`, `/auth/login`).
 * - Session cookies are automatically included.
 * - Throws an Error when the response is not OK.
 *
 * @param {string} path API path (prefixed automatically by `VITE_API_BASE_URL`).
 * @param {object} [options]
 * @param {string} [options.method='GET'] HTTP method.
 * @param {any} [options.body] JSON body (object) or FormData.
 * @param {Record&lt;string,string>} [options.headers={}] Extra headers.
 * @param {boolean} [options.formData=false] When true, forces FormData behavior.
 * @returns {Promise&lt;any>} Parsed response body.
 */
export async function apiRequest(path, { method = 'GET', body, headers = {}, formData = false } = {}) {
  const finalHeaders = { ...headers };

  // Session based auth - no token needed
  // if (token) {
  //   finalHeaders.Authorization = `Bearer ${token}`;
  // }

  const options = { 
    method, 
    headers: finalHeaders,
    credentials: 'include'
  };

  if (body) {
    if (formData || (typeof FormData !== 'undefined' &amp;&amp; body instanceof FormData)) {
      options.body = body;
      // Let browser set Content-Type with boundary
      delete finalHeaders['Content-Type'];
    } else {
      finalHeaders['Content-Type'] = finalHeaders['Content-Type'] || 'application/json';
      options.body = JSON.stringify(body);
    }
  }

  const baseUrl = getApiBaseUrl();
  const response = await fetch(`${baseUrl}${path}`, options);
  const payload = await parseResponse(response);

  if (!response.ok) {
    const error = typeof payload === 'string' ? { message: payload } : payload;
    throw new Error(error?.error || error?.message || 'Request failed');
  }

  return payload;
}

/**
 * Resolves a backend-served media path to a fully qualified URL.
 *
 * - Absolute URLs are returned unchanged.
 * - Relative paths are resolved against the API origin.
 *
 * @param {string} path Backend media path, e.g. `/uploads/file.jpg`.
 * @returns {string} Fully qualified URL.
 */
export const resolveMediaUrl = (path) => {
  if (!path) return '';
  if (/^https?:\/\//i.test(path)) return path;
  const origin = getApiOrigin();
  const cleanPath = path.startsWith('/') ? path : `/${path}`;
  return `${origin}${cleanPath}`;
};

export { getApiBaseUrl };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="SystemLogger.html">SystemLogger</a></li></ul><h3>Global</h3><ul><li><a href="global.html#NotificationsBell">NotificationsBell</a></li><li><a href="global.html#acceptInvite">acceptInvite</a></li><li><a href="global.html#apiRequest">apiRequest</a></li><li><a href="global.html#changePassword">changePassword</a></li><li><a href="global.html#createGalleryItem">createGalleryItem</a></li><li><a href="global.html#createNotification">createNotification</a></li><li><a href="global.html#declineInvite">declineInvite</a></li><li><a href="global.html#decodeIfBase64">decodeIfBase64</a></li><li><a href="global.html#deleteGalleryItem">deleteGalleryItem</a></li><li><a href="global.html#deleteNotification">deleteNotification</a></li><li><a href="global.html#down">down</a></li><li><a href="global.html#emitToUser">emitToUser</a></li><li><a href="global.html#forgotPassword">forgotPassword</a></li><li><a href="global.html#getApiOrigin">getApiOrigin</a></li><li><a href="global.html#getFileInfo">getFileInfo</a></li><li><a href="global.html#getIO">getIO</a></li><li><a href="global.html#getNotificationById">getNotificationById</a></li><li><a href="global.html#getNotifications">getNotifications</a></li><li><a href="global.html#getResendClient">getResendClient</a></li><li><a href="global.html#handleUploadErrors">handleUploadErrors</a></li><li><a href="global.html#inviteToTeam">inviteToTeam</a></li><li><a href="global.html#listGallery">listGallery</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#me">me</a></li><li><a href="global.html#normalizeBase">normalizeBase</a></li><li><a href="global.html#parseResponse">parseResponse</a></li><li><a href="global.html#redirectIfAuthenticated">redirectIfAuthenticated</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#requireAdminSession">requireAdminSession</a></li><li><a href="global.html#requireOwnership">requireOwnership</a></li><li><a href="global.html#requireRole">requireRole</a></li><li><a href="global.html#resetPassword">resetPassword</a></li><li><a href="global.html#resolveMediaUrl">resolveMediaUrl</a></li><li><a href="global.html#sendPasswordResetCodeEmail">sendPasswordResetCodeEmail</a></li><li><a href="global.html#setIO">setIO</a></li><li><a href="global.html#up">up</a></li><li><a href="global.html#updateNotification">updateNotification</a></li><li><a href="global.html#uploadMiddleware">uploadMiddleware</a></li><li><a href="global.html#validatePasswordStrength">validatePasswordStrength</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Jan 12 2026 00:44:31 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
